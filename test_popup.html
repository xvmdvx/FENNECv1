<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FENNEC Popup Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .description {
            color: #666;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .url-display {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>FENNEC Popup Functionality Test</h1>
        
        <div class="test-section">
            <h3>Test 1: PDF Files</h3>
            <div class="description">Test opening PDF files in popup windows</div>
            <div class="url-display">https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf</div>
            <button class="test-button" onclick="testPopup('https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf')">
                Open PDF File
            </button>
        </div>

        <div class="test-section">
            <h3>Test 2: Image Files</h3>
            <div class="description">Test opening image files in popup windows</div>
            <div class="url-display">https://picsum.photos/800/600</div>
            <button class="test-button" onclick="testPopup('https://picsum.photos/800/600')">
                Open Image File
            </button>
        </div>

        <div class="test-section">
            <h3>Test 3: HTML Files</h3>
            <div class="description">Test opening HTML files in popup windows</div>
            <div class="url-display">https://example.com</div>
            <button class="test-button" onclick="testPopup('https://example.com')">
                Open HTML File
            </button>
        </div>

        <div class="test-section">
            <h3>Test 4: Text Files</h3>
            <div class="description">Test opening text files in popup windows</div>
            <div class="url-display">https://www.w3.org/TR/PNG/iso_8859-1.txt</div>
            <button class="test-button" onclick="testPopup('https://www.w3.org/TR/PNG/iso_8859-1.txt')">
                Open Text File
            </button>
        </div>

        <div class="test-section">
            <h3>Test 5: Invalid URL</h3>
            <div class="description">Test error handling with invalid URL</div>
            <button class="test-button" onclick="testPopup('')">
                Test Invalid URL
            </button>
        </div>

        <div class="test-section">
            <h3>Test 6: Custom URL</h3>
            <div class="description">Test with a custom URL</div>
            <input type="text" id="customUrl" placeholder="Enter URL to test" style="width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; border-radius: 3px;">
            <button class="test-button" onclick="testCustomUrl()">
                Test Custom URL
            </button>
        </div>
    </div>

    <script>
        // Simulate the openFileInPopup function
        function openFileInPopup(url) {
            if (!url) {
                console.error('[FENNEC] No URL provided to openFileInPopup');
                alert('Error: No URL provided');
                return;
            }
            
            // Calculate 70% of current window dimensions
            const width = Math.floor(window.screen.width * 0.7);
            const height = Math.floor(window.screen.height * 0.7);
            
            // Calculate center position
            const left = Math.floor((window.screen.width - width) / 2);
            const top = Math.floor((window.screen.height - height) / 2);
            
            // Window features for popup
            const features = [
                `width=${width}`,
                `height=${height}`,
                `left=${left}`,
                `top=${top}`,
                'scrollbars=yes',
                'resizable=yes',
                'toolbar=no',
                'menubar=no',
                'location=no',
                'status=no'
            ].join(',');
            
            try {
                const popup = window.open(url, '_blank', features);
                if (popup) {
                    popup.focus();
                    console.log('[FENNEC] File opened in popup window:', url);
                    console.log('[FENNEC] Popup dimensions:', width, 'x', height);
                    console.log('[FENNEC] Popup position:', left, ',', top);
                } else {
                    console.warn('[FENNEC] Popup blocked, falling back to regular window.open');
                    window.open(url, '_blank');
                }
            } catch (error) {
                console.error('[FENNEC] Error opening popup:', error);
                // Fallback to regular window.open
                window.open(url, '_blank');
            }
        }

        function testPopup(url) {
            console.log('[TEST] Testing popup with URL:', url);
            openFileInPopup(url);
        }

        function testCustomUrl() {
            const url = document.getElementById('customUrl').value.trim();
            if (url) {
                testPopup(url);
            } else {
                alert('Please enter a URL to test');
            }
        }

        // Add to global scope for testing
        window.openFileInPopup = openFileInPopup;
        window.testPopup = testPopup;
        window.testCustomUrl = testCustomUrl;

        console.log('[TEST] FENNEC Popup Test Page Loaded');
        console.log('[TEST] Screen dimensions:', window.screen.width, 'x', window.screen.height);
        console.log('[TEST] Expected popup dimensions:', Math.floor(window.screen.width * 0.7), 'x', Math.floor(window.screen.height * 0.7));
    </script>
</body>
</html>
